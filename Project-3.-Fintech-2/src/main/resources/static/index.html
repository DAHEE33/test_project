<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyPay - ë¡œê·¸ì¸</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/login.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦ EasyPay</h1>
            <p>ì•ˆì „í•˜ê³  í¸ë¦¬í•œ ê°€ìƒê³„ì¢Œ ì„œë¹„ìŠ¤</p>
        </div>

        <div class="login-form">
            <h2>ë¡œê·¸ì¸</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-phone">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="tel" id="login-phone" placeholder="010-1234-5678" required>
                </div>
                <div class="form-group">
                    <label for="login-password">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <span class="loading" id="login-loading"></span>
                    ë¡œê·¸ì¸
                </button>
            </form>
            
            <div class="signup-link">
                <p>ì•„ì´ë””ê°€ ì—†ìœ¼ì‹ ê°€ìš”? <a href="/register.html">íšŒì›ê°€ì…í•˜ê¸°</a></p>
            </div>

            <div class="sample-accounts">
                <h4>ğŸ¯ í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ê³„ì •</h4>
                <div class="sample-account" onclick="fillLoginForm('010-1234-5678', 'password123')">
                    <span class="phone">010-1234-5678</span>
                    <span class="password">password123</span>
                </div>
                <div class="sample-account" onclick="fillLoginForm('010-9876-5432', 'password456')">
                    <span class="phone">010-9876-5432</span>
                    <span class="password">password456</span>
                </div>
                <p style="text-align: center; margin-top: 10px; font-size: 0.8em; color: #666;">
                    í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤
                </p>
            </div>

            <div class="alert" id="login-alert"></div>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script>
        // ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phone = document.getElementById('login-phone').value;
            const password = document.getElementById('login-password').value;
            const loading = document.getElementById('login-loading');
            const alert = document.getElementById('login-alert');
            
            loading.classList.add('show');
            alert.className = 'alert';
            alert.style.display = 'none';
            
            try {
                const response = await login(phone, password);
                
                if (response.accessToken) {
                    // ë¡œê·¸ì¸ ì„±ê³µ - ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                    localStorage.setItem('accessToken', response.accessToken);
                    localStorage.setItem('refreshToken', response.refreshToken);
                    localStorage.setItem('userPhone', phone);
                    
                    showAlert('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                    setTimeout(() => {
                        window.location.href = '/dashboard.html';
                    }, 1000);
                }
            } catch (error) {
                // êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                if (error.message.includes('INVALID_CREDENTIALS')) {
                    errorMessage = 'íœ´ëŒ€í° ë²ˆí˜¸ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                } else if (error.message.includes('ACCOUNT_NOT_FOUND')) {
                    errorMessage = 'í•´ë‹¹ ê³„ì •ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('ACCOUNT_LOCKED')) {
                    errorMessage = 'ê³„ì •ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('ACCOUNT_INACTIVE')) {
                    errorMessage = 'ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
                } else if (error.message.includes('NetworkError') || error.message.includes('fetch')) {
                    errorMessage = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                showAlert(errorMessage, 'error');
            } finally {
                loading.classList.remove('show');
            }
        });

        function fillLoginForm(phone, password) {
            document.getElementById('login-phone').value = phone;
            document.getElementById('login-password').value = password;
        }

        function showAlert(message, type) {
            const alert = document.getElementById('login-alert');
            alert.textContent = message;
            alert.className = `alert alert-${type} show`;
        }
    </script>
</body>
</html> 